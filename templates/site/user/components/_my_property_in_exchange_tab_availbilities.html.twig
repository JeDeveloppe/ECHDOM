{#
    Ce fichier est inclus dans edit.html.twig et contient le formulaire
    pour les disponibilités du bien.
    Le formulaire est passé à la vue sous la variable 'availabilityForm'.
#}

{% form_theme availabilityForm 'bootstrap_5_layout.html.twig' %}

{{ form_start(availabilityForm, {'attr': {'id': 'availability-form'}}) }}

<div class="row">
    {# Champ de formulaire 'startAt' #}
    <div class="col-md-6 mb-4">
        {{ form_row(availabilityForm.startAt) }}
    </div>
    
    {# Champ de formulaire 'endAt' #}
    <div class="col-md-6 mb-4">
        {{ form_row(availabilityForm.endAt) }}
    </div>
</div>

{#
    Champ de formulaire 'weeklyDays' - rendu en tant que cases à cocher
    Utilisation de flexbox de Bootstrap pour un affichage en ligne avec espacement
#}
<div class="mb-4">
    {{ form_label(availabilityForm.weeklyDays) }}
    <div class="d-flex flex-wrap justify-content-start">
        {% for dayField in availabilityForm.weeklyDays %}
            <div class="form-check form-check-inline me-3 mb-2">
                {{ form_widget(dayField) }}
                {{ form_label(dayField) }}
            </div>
        {% endfor %}
    </div>
</div>

{{ form_rest(availabilityForm) }}
<button type="submit" class="btn btn-primary mt-4">Enregistrer les disponibilités</button>

{{ form_end(availabilityForm) }}

<hr class="my-5">

{# Affichage des disponibilités existantes #}
<h3 class="fw-bold text-primary mb-4">Vos disponibilités actuelles</h3>

<div class="container my-5">
    {% set currentMonth = '' %}
    {% if homeAvailabilities is not empty %}
        <p class="text-muted text-center mb-4">
            Toutes les disponibilités commencent à 12h00 et se terminent à 11h59.
        </p>
    {% endif %}

    {% for availability in homeAvailabilities %}
        {% set newMonth = availability.startAt|date('F Y') %}

        {% if newMonth != currentMonth %}
            <h4 class="mt-5 mb-3 fw-bold text-primary">
                {{ newMonth|capitalize }}
            </h4>
            {% set currentMonth = newMonth %}
        {% endif %}

        <div class="card shadow-sm mb-3">
            <div class="card-body py-2">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <span class="d-block fw-semibold">{{ availability.startAt|date('l d')|capitalize }}</span>
                        <span class="text-muted">{{ availability.startAt|date('F Y') }}</span>
                    </div>
                    <span class="badge bg-success text-white py-2 px-3 fw-normal">
                        Disponible
                    </span>
                </div>
            </div>
        </div>

    {% else %}
        <div class="text-center py-5">
            <p class="text-muted">Aucune disponibilité enregistrée pour le moment.</p>
        </div>
    {% endfor %}
</div>
           
