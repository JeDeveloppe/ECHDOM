{% extends 'site/base.html.twig' %}

{% block title %}Mon bien à l'échange{% endblock %}

{% block nav %}
   {% include "site/user/_nav_user.html.twig" %}
{% endblock %}

{% block body %}
    <div class="container my-5">

        <!-- Titre et sous-titre de la page -->
        <div class="row mb-4 pt-5">
            <div class="col-12 text-center pt-5">
                <h1 class="fw-bold text-primary display-4">Mon bien à l'échange</h1>
                <p class="lead text-muted">
                    Renseignez les informations de votre bien.
                </p>
            </div>
        </div>

        <!-- Affichage des messages flash (succès, erreur, etc.) -->
        {% for message in app.flashes('success') %}
            <div class="alert alert-success rounded-3 shadow-sm mb-4">
                {{ message }}
            </div>
        {% endfor %}

        <!-- Conteneur des onglets -->
        <div class="card shadow-lg border-0 rounded-4">
            <div class="card-body p-4 p-md-5">

                <!-- Navigation par onglets -->
                <ul class="nav nav-tabs nav-fill mb-4 border-0" id="myTab" role="tablist" style="border-bottom: 2px solid #e9ecef;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active fw-bold text-dark border-0 rounded-top-3" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-info" type="button" role="tab" aria-controls="home-info" aria-selected="true" style="border-bottom: 2px solid #0d6efd;">Informations principales</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link fw-bold text-muted border-0 rounded-top-3" id="availability-tab" data-bs-toggle="tab" data-bs-target="#availability" type="button" role="tab" aria-controls="availability" aria-selected="false" style="border-bottom: 2px solid transparent;">Gestion des disponibilités</button>
                    </li>
                </ul>
                
                <!-- Contenu des onglets -->
                <div class="tab-content" id="myTabContent">
                    
                    <!-- Onglet des informations principales du bien -->
                    <div class="tab-pane fade show active" id="home-info" role="tabpanel" aria-labelledby="home-tab">
                        {% include "site/user/components/_my_property_in_exchange_tab_infos.html.twig" %}
                    </div>


                    <!-- Nouvel onglet pour les disponibilités (inclus le formulaire de récurrence) -->
                    <div class="tab-pane fade" id="availability" role="tabpanel" aria-labelledby="availability-tab">
                        {% include "site/user/components/_my_property_in_exchange_tab_availbilities.html.twig" with {'availabilityForm': availabilityForm} %}
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}
    
{% block javascripts %}
    {{ parent() }}

    <!-- Script JavaScript pour les options de récurrence -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Récupérer les éléments du DOM avec les identifiants corrects
            const isRecurringCheckbox = document.getElementById('home_availability_form_isRecurring');
            const endAtLabel = document.getElementById('end-at-label');
            const recurrenceOptions = document.getElementById('recurrence-options');

            // Fonction pour mettre à jour l'affichage et le texte des labels
            function updateFormVisibility() {
                if (isRecurringCheckbox && isRecurringCheckbox.checked) {
                    // Si la case est cochée, on change le label et on affiche les options
                    if (endAtLabel) {
                        endAtLabel.textContent = 'Répéter jusqu\'au';
                    }
                    if (recurrenceOptions) {
                        recurrenceOptions.classList.remove('d-none');
                    }
                } else {
                    // Si la case n'est pas cochée, on réinitialise le label et on cache les options
                    if (endAtLabel) {
                        endAtLabel.textContent = 'Date de fin';
                    }
                    if (recurrenceOptions) {
                        recurrenceOptions.classList.add('d-none');
                    }
                }
            }

            // Exécuter la fonction au chargement de la page pour initialiser l'affichage
            updateFormVisibility();

            // Ajouter l'écouteur d'événement pour la case à cocher
            if (isRecurringCheckbox) {
                isRecurringCheckbox.addEventListener('change', updateFormVisibility);
            }
        });
    </script>
{% endblock %}
